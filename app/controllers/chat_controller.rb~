require 'securerandom'
require 'socket'

class IRCUser
  attr_accessor :has_authenticated, :just_changed, :is_op;

  def initialize
    @has_authenticated = false;
    @is_op = false;
    $guest_counter += 1;
  end
end

class ChatController < ApplicationController
  before_action :authenticate_user!
  @tokens = {}
  
  Thread.new {
    socket = TCPSocket.new(get_setting("IRCHostname", "IRCPort"));
    users = {}
    channels = [];
    guest_counter = 0
    
    socket.puts("PASS #{get_setting("IRCPass")} TS 6 :#{get_setting("IRCServerID")}");
    socket.puts("CAPAB QS ENCAP SERVICES");
    socket.puts("SERVER #{get_setting("IRCServerName")} 1 #{get_setting("IRCServerID")} :#{get_setting("IRCPass")}");
    socket.puts("SVINFO 6 6 0 #{Time.now.to_i}");
    socket.puts(":#{get_setting("IRCServerID")} UID Community 1 #{Time.now.to_i} +o qpixel qpixel 0 #{get_setting("IRCServerID") + "AAAAAA"} :Robot")
  }

  def index
  end

  def new_token
    id = SecureRandom.hex(8)
    @tokens[id] = current_user
    return id 
  end

  
end
